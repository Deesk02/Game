<!DOCTYPE html>
<html>

<canvas id="gameCanvas" width="800" height="600"></canvas>

<script> 
var canvas;
var canvasContext;
var ballX = 50;
var ballSpeedX= 5;
var ballY = 10;
var ballSpeedY= 4;

var player1Score = 0;
var player2Score = 0;
const WIN = 3;

var winScreen = false;

var paddle1Y=250;
var paddle2Y=250;
const PADDLE_HEIGHT = 100;
const THICC=10;
const CPUSPD=8;


function calcMousePos(evt){
  var rect = canvas.getBoundingClientRect();
  var root = document.documentElement;
  var mouseX = evt.clientX - rect.left - root.scrollLeft;
  var mouseY = evt.clientY - rect.top - root.scrollTop;
  return {
    x:mouseX,
    y:mouseY
  };
}

window.onload = function(){
  canvas = document.getElementById('gameCanvas');
  canvasContext = canvas.getContext('2d');
  var framesPerSecond = 30;
  setInterval(function(){
    move();
    draw();
  }, 1000/framesPerSecond);

  canvas.addEventListener('mousemove',
    function(evt){
      var mousePos = calcMousePos(evt);
      paddle1Y = mousePos.y-(PADDLE_HEIGHT/2);
    });
}

function reset(){
  if(player1Score >= WIN ||
     player2Score >= WIN){
       player1Score=0;
       player2Score=0;
       winScreen= true;
     }
  ballSpeedX = -ballSpeedX;
  ballSpeedY = -ballSpeedY;
  ballX = canvas.width/2;
  ballY = canvas.height/2;
}

function cpuMove(){
  var paddle2YCenter = paddle2Y+(PADDLE_HEIGHT/2);
  if(paddle2YCenter < ballY-35){
    paddle2Y+=CPUSPD;
  } else if(paddle2YCenter > ballY+35){
    paddle2Y-=CPUSPD;
  }
}

function move(){
if(winScreen){
  return;
}


  cpuMove();

  ballX = ballX + ballSpeedX;
   if(ballX < 0){
      if(ballY > paddle1Y &&
         ballY < paddle1Y+PADDLE_HEIGHT){
           ballSpeedX = -ballSpeedX;
          
          var deltaY = ballY
          -(paddle1Y+PADDLE_HEIGHT/2);
          ballSpeedY=deltaY * 0.35;}
           else {
            player2Score++; //must score before reset
            reset();
           }
    }
  
  if(ballX > canvas.width){
      if(ballY > paddle2Y &&
         ballY < paddle2Y+PADDLE_HEIGHT){
           ballSpeedX = -ballSpeedX;
           var deltaY = ballY
          -(paddle2Y+PADDLE_HEIGHT/2);
          ballSpeedY=deltaY * 0.35;}
           else {
             player1Score++;
             reset();
           }
  }
  ballY = ballY + ballSpeedY;
   if(ballY < 0){
        ballSpeedY = -ballSpeedY;
    }
  if(ballY > canvas.height){
        ballSpeedY = -ballSpeedY;
    }
}

function draw(){
  //background
  rect(0,0,canvas.width, canvas.height, 'black');
  
  if(winScreen){
    canvasContext.fillStyle='white';
    canvasContext.fillText("GAME OVER! Someone won and someone lost, but frankly I don't care enough to program who won or lost so instead you get this message! Have a nice day! Refresh to reset.", 10, canvas.height/2);
  return;
}
  //left paddle
  rect(1, paddle1Y, THICC, PADDLE_HEIGHT, 'white');
  //right paddle
  rect(canvas.width-THICC, paddle2Y, THICC, PADDLE_HEIGHT, 'white');
  //ball
  circle(ballX, ballY, 10, 'white')

canvasContext.fillText(player1Score, 100, 100);
canvasContext.fillText(player2Score, canvas.width-100, 100);

    }

function circle(centerX, centerY, radius, drawColor){
    canvasContext.fillStyle = drawColor;
  canvasContext.beginPath();
  canvasContext.arc(centerX, centerY, radius, 0, Math.PI*2, true);
  canvasContext.fill();
}

function rect(leftX,topY, width, height, drawColor){
    canvasContext.fillStyle = drawColor;
    canvasContext.fillRect(leftX,topY, width, height);
}

</script>
</html>